# 機能仕様書: メモ帳アプリ

> この仕様書はメモ帳アプリの機能仕様を定義する。
> 実装はこの仕様書に**厳密に従う**こと。仕様に記載のない機能の実装は**禁止**。

---

## 1. 機能概要

メモ帳アプリは、ログイン認証を経たユーザーがメモの作成・閲覧・編集・削除（CRUD）を行うためのWebアプリケーションである。

---

## 2. 要件一覧

### Must（必須）

- [x] 要件1: ユーザーはユーザー名とパスワードでログインできる
- [x] 要件2: 未ログインユーザーはメモ画面にアクセスできない（ログイン画面にリダイレクト）
- [x] 要件3: ログイン済みユーザーはメモの一覧を閲覧できる
- [x] 要件4: ログイン済みユーザーはメモを新規作成できる（タイトル + 本文）
- [x] 要件5: ログイン済みユーザーはメモを編集できる
- [x] 要件6: ログイン済みユーザーはメモを削除できる
- [x] 要件7: ログイン済みユーザーはログアウトできる
- [x] 要件8: アプリ起動時に admin ユーザー（パスワード: admin）が自動作成される
- [x] 要件9: 日本語の入力・表示が文字化けしない（UTF-8対応）

### Nice to have（任意）

- [ ] 要件A: メモの検索・フィルタ機能
- [ ] 要件B: ユーザー登録機能
- [ ] 要件C: ページネーション

---

## 3. データモデル

### memos

| フィールド | 型 | 制約 | 説明 |
|---|---|---|---|
| id | INT | PK, AUTO_INCREMENT | メモの一意な識別子 |
| title | VARCHAR(255) | NOT NULL | メモのタイトル |
| content | TEXT | — | メモの本文 |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 作成日時 |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 更新日時 |

### users

| フィールド | 型 | 制約 | 説明 |
|---|---|---|---|
| id | INT | PK, AUTO_INCREMENT | ユーザーの一意な識別子 |
| username | VARCHAR(255) | NOT NULL, UNIQUE | ユーザー名 |
| password | VARCHAR(255) | NOT NULL | パスワード（SHA-256ハッシュ） |

---

## 4. API / エンドポイント

### メモ一覧取得

| 項目 | 内容 |
|---|---|
| メソッド | `GET` |
| パス | `/api/memos` |
| リクエスト | なし |
| レスポンス（成功） | `200 OK` + JSON配列 |

**レスポンス例:**

```json
[
  {
    "id": 1,
    "title": "買い物リスト",
    "content": "牛乳、パン、卵",
    "createdAt": "2026-02-19T10:00:00",
    "updatedAt": "2026-02-19T10:00:00"
  }
]
```

### メモ1件取得

| 項目 | 内容 |
|---|---|
| メソッド | `GET` |
| パス | `/api/memos?id={id}` |
| リクエスト | クエリパラメータ `id` |
| レスポンス（成功） | `200 OK` + JSONオブジェクト |
| レスポンス（エラー） | `404 Not Found`（対象なし） |

### メモ新規作成

| 項目 | 内容 |
|---|---|
| メソッド | `POST` |
| パス | `/api/memos` |
| リクエスト | JSON（`title`, `content`） |
| レスポンス（成功） | `201 Created` + 作成されたメモ |

**リクエスト例:**

```json
{
  "title": "買い物リスト",
  "content": "牛乳、パン、卵"
}
```

### メモ更新

| 項目 | 内容 |
|---|---|
| メソッド | `PUT` |
| パス | `/api/memos` |
| リクエスト | JSON（`id`, `title`, `content`） |
| レスポンス（成功） | `200 OK` + 更新されたメモ |
| レスポンス（エラー） | `404 Not Found`（対象なし） |

### メモ削除

| 項目 | 内容 |
|---|---|
| メソッド | `DELETE` |
| パス | `/api/memos?id={id}` |
| リクエスト | クエリパラメータ `id` |
| レスポンス（成功） | `204 No Content` |

### ログイン

| 項目 | 内容 |
|---|---|
| メソッド | `POST` |
| パス | `/api/auth/login` |
| リクエスト | JSON（`username`, `password`） |
| レスポンス（成功） | `200 OK` + `{"success": true, "message": "ログインしました"}` |
| レスポンス（エラー） | `401 Unauthorized` + `{"success": false, "message": "ユーザー名またはパスワードが正しくありません"}` |

**リクエスト例:**

```json
{
  "username": "admin",
  "password": "admin"
}
```

### ログアウト

| 項目 | 内容 |
|---|---|
| メソッド | `POST` |
| パス | `/api/auth/logout` |
| リクエスト | なし |
| レスポンス（成功） | `200 OK` + `{"success": true, "message": "ログアウトしました"}` |

---

## 5. UI / 画面仕様

### 画面一覧

| 画面名 | URL | 概要 |
|---|---|---|
| ログイン画面 | `/login.html` | ユーザー名・パスワードの入力フォーム |
| メモ画面 | `/index.html` | メモの一覧表示・作成・編集 |

### ログイン画面の構成

```
+------------------------------------------+
| ヘッダー: メモ帳                          |
+------------------------------------------+
|                                          |
|   +----------------------------------+   |
|   | ログイン                          |   |
|   |                                  |   |
|   | ユーザー名: [______________]     |   |
|   | パスワード: [______________]     |   |
|   |                                  |   |
|   | (エラーメッセージ表示エリア)      |   |
|   |                                  |   |
|   | [ログインボタン]                  |   |
|   +----------------------------------+   |
|                                          |
+------------------------------------------+
| フッター                                  |
+------------------------------------------+
```

### メモ画面の構成

```
+------------------------------------------+
| ヘッダー: メモ帳         [ログアウト]     |
+------------------------------------------+
| メモ一覧           [新規作成ボタン]       |
+------------------------------------------+
| 一覧表示エリア                            |
|   +--------------------------------------+|
|   | タイトル              更新日時        ||
|   | 本文（1行省略表示）                   ||
|   +--------------------------------------+|
|   | ...                                  ||
+------------------------------------------+
| エディタ（非表示 → 新規作成/編集時に表示）|
|   +--------------------------------------+|
|   | 新規メモ / メモを編集                ||
|   | タイトル: [______________]           ||
|   | 内容:                                ||
|   | [____________________________]       ||
|   | [____________________________]       ||
|   |                                      ||
|   | [保存] [キャンセル]                  ||
|   +--------------------------------------+|
+------------------------------------------+
| フッター                                  |
+------------------------------------------+
```

### 操作フロー

1. **ログイン**: ログイン画面でユーザー名・パスワード入力 → ログインボタン → 認証成功でメモ画面に遷移 / 失敗でエラーメッセージ表示
2. **メモ一覧表示**: メモ画面表示時に自動的にメモ一覧を取得・描画（更新日時の降順）
3. **新規作成**: 新規作成ボタン → エディタ表示 → タイトル・内容入力 → 保存 → 一覧再取得
4. **編集**: メモ一覧のアイテムをクリック → エディタに既存データ表示 → 編集 → 保存 → 一覧再取得
5. **削除**: （現在UIに削除ボタンなし。app.js に deleteMemo 関数は実装済み）
6. **ログアウト**: ヘッダーのログアウトボタン → セッション破棄 → ログイン画面に遷移

---

## 6. エラーハンドリング

| エラー条件 | HTTPステータス | ユーザーへの表示 |
|---|---|---|
| ログイン認証失敗 | 401 | 「ユーザー名またはパスワードが正しくありません」 |
| 未ログインでAPI呼び出し | 401 | 「認証が必要です」（JSON） |
| 未ログインでページアクセス | 302 | ログイン画面にリダイレクト |
| 存在しないメモを取得/更新 | 404 | 「メモが見つかりません」 |
| 削除時にIDが未指定 | 400 | 「IDが指定されていません」 |

---

## 7. スコープ外

以下は本仕様のスコープ外とし、**実装しない**:

- ユーザー登録機能（admin ユーザーのみ使用可能）
- パスワード変更機能
- ページネーション
- メモの検索・フィルタ機能
- ファイル添付機能
- レスポンシブデザイン対応
- ユーザーごとのメモ分離（全メモが全ユーザーに表示される）

---

## 8. 完了条件

以下のすべてを満たした場合、本仕様の実装は完了とする:

- [x] 「2. 要件一覧」のMust項目がすべてチェック済み
- [x] 「4. API / エンドポイント」のすべてのエンドポイントが仕様通り動作する
- [x] 「5. UI / 画面仕様」の操作フローがすべて正常に動作する
- [x] 「6. エラーハンドリング」のすべてのケースで正しいメッセージが表示される
- [x] 「7. スコープ外」の機能が実装されていない
- [x] `docs/architecture.html` が最新の実装と一致している
